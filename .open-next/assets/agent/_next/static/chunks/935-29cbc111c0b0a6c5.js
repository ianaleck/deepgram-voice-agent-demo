"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[935],{2583:function(e,t,n){n.d(t,{DeepgramContextProvider:function(){return u},Y:function(){return c}});var r=n(7437),o=n(2265),a=n(3802);let s=(0,o.createContext)(),u=e=>{let{children:t}=e,[n,u]=(0,o.useState)(),[c,l]=(0,o.useState)(-1),[i,d]=(0,o.useState)(0),[f,g]=(0,o.useState)(!1),D=(0,o.useRef)(),p=async()=>{if(i>=5){console.log("Max reconnect attempts reached."),g(!0);return}l(0),console.log("\uD83D\uDD0C Starting WebSocket connection...");let e=await (0,a.bW)();console.log("\uD83C\uDFAB Auth token for WebSocket:",e);let t="wss://agent.deepgram.com/v1/agent/converse",n=["bearer",e];console.log("\uD83C\uDF10 WebSocket URL:",t),console.log("\uD83D\uDCDD WebSocket protocols:",n);let r=new WebSocket(t,n);console.log("\uD83D\uDE80 WebSocket created, ready state:",r.readyState),r.binaryType="arraybuffer",r.addEventListener("open",()=>{l(1),d(0),console.log("✅ WebSocket connected successfully!"),console.log("\uD83D\uDD17 WebSocket ready state:",r.readyState),D.current=setInterval((0,a.G7)(r),1e4)}),r.addEventListener("error",e=>{l(2),console.error("❌ WebSocket error details:",e),console.error("\uD83D\uDD17 WebSocket ready state:",r.readyState),console.error("\uD83C\uDF10 WebSocket URL:",r.url),console.error("\uD83D\uDCDD WebSocket protocol:",r.protocol)}),r.addEventListener("close",e=>{clearInterval(D.current),l(3),console.error("\uD83D\uDD0C WebSocket closed. Details:"),console.error("   Code:",e.code),console.error("   Reason:",e.reason),console.error("   Was Clean:",e.wasClean),console.error("   Ready State:",r.readyState),console.error("   Close Code Meaning:",{1e3:"Normal closure",1001:"Going away",1002:"Protocol error",1003:"Unsupported data",1004:"Reserved",1005:"No status received",1006:"Abnormal closure",1007:"Invalid frame payload data",1008:"Policy violation",1009:"Message too big",1010:"Mandatory extension",1011:"Internal server error",1015:"TLS handshake failure",4001:"Unauthorized",4003:"Forbidden",4008:"Rate limited",4009:"Conflict"}[e.code]||"Unknown"),console.info("\uD83D\uDD04 Attempting to reconnect in 3 seconds..."),setTimeout(p,3e3),d(e=>e+1)}),r.addEventListener("message",()=>{}),u(r)};return(0,r.jsx)(s.Provider,{value:{socket:n,socketState:c,rateLimited:f,connectToDeepgram:p},children:t})};function c(){return(0,o.useContext)(s)}},60:function(e,t,n){n.d(t,{MicrophoneContextProvider:function(){return s},p:function(){return u}});var r=n(7437),o=n(2265);let a=(0,o.createContext)(),s=e=>{let{children:t}=e,[n,s]=(0,o.useState)(null),[u,c]=(0,o.useState)(),[l,i]=(0,o.useState)(),[d,f]=(0,o.useState)(),g=async()=>{s(0);try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,volume:1,echoCancellation:!0,noiseSuppression:!1,latency:0}}),t=new AudioContext,n=t.createMediaStreamSource(e),r=t.createScriptProcessor(4096,1,1);c(n),i(t),f(r),s(1)}catch(e){console.error(e),"NotFoundError"!==e.name&&"NotAllowedError"!==e.name&&console.log(e.name)}},D=(0,o.useCallback)(()=>{u.connect(d),d.connect(l.destination),s(2)},[d,l,u]);return(0,r.jsx)(a.Provider,{value:{microphone:u,startMicrophone:D,setupMicrophone:g,microphoneState:n,microphoneAudioContext:l,setMicrophoneAudioContext:i,processor:d},children:t})};function u(){return(0,o.useContext)(a)}},2298:function(e,t,n){n.d(t,{tw:function(){return a},VoiceBotProvider:function(){return b},aI:function(){return s},Ct:function(){return S},wc:function(){return v},Z$:function(){return y},jq:function(){return T}});var r,o,a,s,u=n(7437),c=n(2265);let l="start_listening",i="start_speaking",d="start_sleeping",f="increment_sleep_timer",g="add_message",D="set_attach_params_to_copy_url",p="add_behind_scenes_event",h=(e,t)=>{switch(t.type){case l:return{...e,status:s.LISTENING,sleepTimer:0};case"start_thinking":return{...e,status:s.THINKING};case i:return{...e,status:s.SPEAKING,sleepTimer:0};case d:return{...e,status:s.SLEEPING};case f:return{...e,sleepTimer:e.sleepTimer+1};case g:return{...e,messages:[...e.messages,t.payload]};case D:return{...e,attachParamsToCopyUrl:t.payload};case p:return{...e,behindTheScenesEvents:[...e.behindTheScenesEvents,t.payload]};default:return e}};(r=a||(a={})).SETTINGS_APPLIED="SettingsApplied",r.AGENT_AUDIO_DONE="AgentAudioDone",r.USER_STARTED_SPEAKING="UserStartedSpeaking",r.AGENT_STARTED_SPEAKING="AgentStartedSpeaking",r.CONVERSATION_TEXT="ConversationText",r.END_OF_THOUGHT="EndOfThought";let S=e=>y(e)||m(e),v=e=>void 0!==e.tts_latency,y=e=>void 0!==e.user,m=e=>void 0!==e.assistant;(o=s||(s={})).LISTENING="listening",o.THINKING="thinking",o.SPEAKING="speaking",o.SLEEPING="sleeping",o.NONE="";let C={status:"",sleepTimer:0,messages:[],attachParamsToCopyUrl:!0,behindTheScenesEvents:[]},E=(0,c.createContext)(void 0);function T(){let e=(0,c.useContext)(E);if(!e)throw Error("useVoiceBot must be used within a VoiceBotProvider");return e}function b(e){let{children:t}=e,[n,r]=(0,c.useReducer)(h,C),o=(0,c.useRef)(!1);(0,c.useEffect)(()=>{let e=setInterval(()=>{r({type:f})},1e3);return()=>clearInterval(e)},[]),(0,c.useEffect)(()=>{n.sleepTimer>30&&k()},[n.sleepTimer]);let a=e=>{r({type:g,payload:e})},s=e=>{r({type:p,payload:e})},T=(0,c.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(e||"sleeping"!==n.status)&&r({type:i})},[n.status]),b=(0,c.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(e||"sleeping"!==n.status)&&r({type:l})},[n.status]),k=()=>{o.current=!0,r({type:d})},_=(0,c.useCallback)(()=>{"sleeping"===n.status?b(!0):k()},[n.status,b]),N=(e,t)=>m(t)&&y(e),I=(0,c.useMemo)(()=>{let e=n.messages.filter(S),t=n.messages.filter(v),r=[];return e.forEach((e,n,o)=>{let a=o[n-1];if(a&&N(e,a)){let e=t.shift();e&&r.push(e)}if(r.push(e),m(e)&&n===o.length-1){let e=t.shift();e&&r.push(e)}}),r},[n.messages]),A=(0,c.useCallback)(e=>{r({type:D,payload:e})},[]),w=(0,c.useMemo)(()=>({...n,isWaitingForUserVoiceAfterSleep:o,displayOrder:I,addVoicebotMessage:a,addBehindTheScenesEvent:s,startSpeaking:T,startListening:b,startSleeping:k,toggleSleep:_,setAttachParamsToCopyUrl:A}),[n,b,T,_,A,I]);return(0,u.jsx)(E.Provider,{value:w,children:t})}},5176:function(e,t,n){function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:24e3,r=new Int16Array(t);if(0===r.length){console.error("Received audio data is empty.");return}let o=e.createBuffer(1,r.length,n),a=o.getChannelData(0);for(let e=0;e<r.length;e++)a[e]=r[e]/32768;return o}function o(e,t,n,r){let o=e.createBufferSource();o.buffer=t,o.connect(r),r.connect(e.destination);let a=e.currentTime;return n.current<a&&(n.current=a),o.start(n.current),n.current+=t.duration,o}function a(e,t,n){if(t===n)return e;let r=t/n,o=new Float32Array(Math.round(e.length/r)),a=0,s=0;for(;a<o.length;){let t=Math.round((a+1)*r),n=0,u=0;for(let r=s;r<t&&r<e.length;r++)n+=e[r],u++;o[a]=n/u,a++,s=t}return o}function s(e){let t=e.length,n=new Int16Array(t);for(;t--;)n[t]=32767*Math.min(1,e[t]);return n.buffer}n.d(t,{DU:function(){return a},FL:function(){return u},Xd:function(){return s},_6:function(){return r},kU:function(){return o}});let u=(e,t,n)=>(e.getByteFrequencyData(t),Math.min(t.reduce((e,t)=>e+t,0)/t.length/n,1))},3802:function(e,t,n){n.d(t,{bW:function(){return o},G7:function(){return u},rn:function(){return a},Mx:function(){return s},wE:function(){return c}});var r=n(5176);let o=async()=>{console.log("\uD83D\uDD11 Fetching auth token...");let e=await fetch(c("/api/authenticate"),{method:"POST"});console.log("\uD83D\uDCE1 Response status:",e.status);let t=await e.json();return console.log("\uD83D\uDCCB Auth result:",t),console.log("\uD83D\uDD10 Token being returned:",t.key),t.key},a=e=>t=>{var n;let o=null==t?void 0:null===(n=t.inputBuffer)||void 0===n?void 0:n.getChannelData(0),a=(0,r.DU)(o,48e3,16e3),s=(0,r.Xd)(a);e.send(s)},s=(e,t)=>{e.send(JSON.stringify(t))},u=e=>()=>{s(e,{type:"KeepAlive"})},c=e=>{let t="/agent";return"/"===e?t:t+e}}}]);